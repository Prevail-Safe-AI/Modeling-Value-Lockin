(base) aq_alexqiu@instance-20250107-222116:~/Modeling-Value-Lockin/data-analysis$ ls
core  data  run_analysis.py
(base) aq_alexqiu@instance-20250107-222116:~/Modeling-Value-Lockin/data-analysis$ CLUSTERS_PD=./data/sample500000/clusters_pd-20250106-073101.csv CLUSTERS=./data/sample500000/clusters-20250106-073114.json HASH=samp
le500000 EMBEDDINGS=./data/embeddings-20250101-213657.json TRUNCATE=500000 LOUD_BACKEND=1 python3 ./run_analysis.py --max_convo_length 360000 run_analysis --dynamic_printing
[nltk_data] Downloading package punkt to /home/aq_alexqiu/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package averaged_perceptron_tagger_eng to
[nltk_data]     /home/aq_alexqiu/nltk_data...
[nltk_data]   Package averaged_perceptron_tagger_eng is already up-to-
[nltk_data]       date!
[nltk_data] Downloading package punkt_tab to
[nltk_data]     /home/aq_alexqiu/nltk_data...
[nltk_data]   Package punkt_tab is already up-to-date!
[nltk_data] Downloading package stopwords to
[nltk_data]     /home/aq_alexqiu/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package wordnet to
[nltk_data]     /home/aq_alexqiu/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
Succesfully loaded dataset from ./data/WildChat-1M. Processing samples...
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [09:15<00:00, 1509.13it/s]
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [00:01<00:00, 540432.17it/s]
Average conversation length: 5202.285858167589
Length deciles: [4, 429, 909, 1507, 2189, 2967, 3961, 5514, 6594, 10589]
Truncating samples to max length of 360000 characters...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [00:01<00:00, 549907.17it/s]
Deduplicating users...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [00:01<00:00, 808942.10it/s]
Removing samples with no IPs, pre-removal count: 837989
Post-removal count: 837989
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [00:04<00:00, 205326.05it/s]
Deduplication complete.
Found 167062 unique users out of 188350 IPs.
Cleaned 837989 samples. Sorting...
Trying to load concepts-cluster from cache...
File not found: sample500000-concepts-cluster.json. Looking for it in the data directory.
Loaded 707204 concepts-cluster. Sorting...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 837989/837989 [00:06<00:00, 137478.64it/s]
Concepts-cluster counts: {0: 50302, 1: 116015, 2: 111018, 3: 98849, 4: 91070, 5: 71525, 6: 47267, 7: 34583, 8: 25568, 9: 18874, 10: 13467, 11: 9143, 12: 6513, 13: 4333, 14: 2907, 15: 1966, 16: 1210, 17: 822, 18: 57
7, 19: 345, 20: 263, 21: 183, 22: 123, 23: 67, 24: 58, 25: 40, 26: 35, 27: 26, 28: 14, 29: 10, 30: 7, 31: 5, 32: 4, 33: 2, 34: 2, 35: 3, 36: 2, 39: 1, 40: 1, 41: 1, 44: 2, 47: 1}
File not found: sample500000-clusterinfo.json. Looking for it in the data directory.
Concepts-cluster counts: {0: 50302, 1: 116015, 2: 111018, 3: 98849, 4: 91070, 5: 71525, 6: 47267, 7: 34583, 8: 25568, 9: 18874, 10: 13467, 11: 9143, 12: 6513, 13: 4333, 14: 2907, 15: 1966, 16: 1210, 17: 822, 18: 57
7, 19: 345, 20: 263, 21: 183, 22: 123, 23: 67, 24: 58, 25: 40, 26: 35, 27: 26, 28: 14, 29: 10, 30: 7, 31: 5, 32: 4, 33: 2, 34: 2, 35: 3, 36: 2, 39: 1, 40: 1, 41: 1, 44: 2, 47: 1}
513383it [00:00, 3838816.61it/s]
513383it [00:00, 5186624.88it/s]
Selected 7555 clusters out of 513383 total.
Cluster size distribution: [0, 0, 3933, 2267, 930, 275, 88, 33, 10, 5, 4, 3, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
Filepath not in data directory. Saving to data/sample500000-selected.json instead.
Filepath not in data directory. Saving to data/sample500000-clusterinfo-postselection.json instead.
Loading user_panel from ./data/sample500000-user_panel.csv...
Failed to load user_panel from ./data/sample500000-user_panel.csv.
Loading temporal_panel1 from ./data/sample500000-temporal_panel1.csv...
Failed to load temporal_panel1 from ./data/sample500000-temporal_panel1.csv.
Loading temporal_panel2 from ./data/sample500000-temporal_panel2.csv...
Failed to load temporal_panel2 from ./data/sample500000-temporal_panel2.csv.
Building all panels... (existing_dict: dict_keys([]))
Building temporal panels...
Earliest date: 2023-04-09 00:02:53+00:00
Latest date: 2024-04-29 23:59:51+00:00
Warning: unknown GPT version gpt-4-0613
Warning: unknown GPT version gpt-4-0613
  1%|█▋                                                                                                                                                                             | 2/211 [02:19<4:12:55, 72.61s/it]
Info: GPT version mode is not dominant in time interval 26 (GPT-3.5), distribution: Counter({0: 2971, 1: 2748})
 59%|███████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                      | 124/211 [3:35:33<2:51:06, 118.01s/it]
Info: GPT version mode is not dominant in time interval 113 (GPT-4), distribution: Counter({1: 2343, 2: 2214})
 62%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                 | 130/211 [3:43:44<2:07:05, 94.14s/it]
 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 160/211 [4:16:43<46:38, 54.88s/it]
Info: GPT version mode is not dominant in time interval 104 (GPT-4), distribution: Counter({1: 1203, 2: 506})
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 210/211 [4:50:12<00:09,  9.11s/it]
Skipping time interval 99 due to insufficient samples (8).
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 211/211 [4:50:12<00:00, 82.52s/it]
Creating panel temporal_panel1...
Saving panel temporal_panel1...
Panel temporal_panel1 created and saved.
Panel temporal_panel1 shape: (212, 12)
Panel temporal_panel1 head:
              gpt_version  overall_nsamples  overall_mean_turns  ... concept_diversity_assistant_concepts_related  concept_diversity_user  concept_diversity_assistant
time is_gpt4                                                     ...
118  0                  2              1913            3.121798  ...                                    13.050480               13.082726                    14.261137
114  1                  2              4271            5.145867  ...                                    16.120409               16.278370                    16.503810
26   0                  0              5719            5.289037  ...                                    15.862965               16.425406                    16.306968
30   0                  1              8206            5.170119  ...                                    15.915348               16.212065                    16.357299
114  0                  2              2970            2.951515  ...                                    13.046131               13.201455                    14.344420

[5 rows x 12 columns]
<class 'pandas.core.frame.DataFrame'>
MultiIndex: 212 entries, (np.int64(118), np.int64(0)) to (np.int64(99), np.int64(0))
Data columns (total 12 columns):
 #   Column                                         Non-Null Count  Dtype
---  ------                                         --------------  -----
 0   gpt_version                                    212 non-null    int64
 1   overall_nsamples                               212 non-null    int64
 2   overall_mean_turns                             212 non-null    float64
 3   overall_mean_conversation_length               212 non-null    object
 4   overall_mean_prompt_length                     212 non-null    float64
 5   concept_diversity                              211 non-null    float64
 6   concept_diversity_user_concepts_explicit       211 non-null    float64
 7   concept_diversity_assistant_concepts_explicit  211 non-null    float64
 8   concept_diversity_user_concepts_related        211 non-null    float64
 9   concept_diversity_assistant_concepts_related   211 non-null    float64
 10  concept_diversity_user                         211 non-null    float64
 11  concept_diversity_assistant                    211 non-null    float64
dtypes: float64(9), int64(2), object(1)
memory usage: 25.8+ KB
Panel temporal_panel1 info:
None
Panel temporal_panel1 summary stats:
       gpt_version  overall_nsamples  overall_mean_turns  \
count   212.000000        212.000000          212.000000
mean      0.933962       3952.806604            4.570882
std       0.656991       2530.934695            1.138373
min       0.000000          8.000000            2.766276
25%       0.750000       2175.000000            3.614331
50%       1.000000       3062.500000            4.325795
75%       1.000000       5550.250000            5.428680
max       2.000000      12011.000000            8.521739

       overall_mean_prompt_length  concept_diversity  \
count                  212.000000         211.000000
mean                  2537.125728          16.043464
std                   1737.809097           0.721174
min                    220.250000          14.291849
25%                   1291.280582          15.839610
50%                   2161.543513          16.341089
75%                   3140.807373          16.563570
max                  14052.853991          16.995847

       concept_diversity_user_concepts_explicit  \
count                                211.000000
mean                                  16.633643
std                                    0.849545
min                                   14.491824
25%                                   16.407846
50%                                   16.926489
75%                                   17.196179
max                                   18.931569

       concept_diversity_assistant_concepts_explicit  \
count                                     211.000000
mean                                       16.225402
std                                         0.664886
min                                        14.687804
25%                                        15.985939
50%                                        16.431332
75%                                        16.719400
max                                        17.313888

       concept_diversity_user_concepts_related  \
count                               211.000000
mean                                 14.995346
std                                   1.237015
min                                  11.667459
25%                                  14.787406
50%                                  15.540609
75%                                  15.828279
max                                  16.181173

       concept_diversity_assistant_concepts_related  concept_diversity_user  \
count                                    211.000000              211.000000
mean                                      15.424252               15.719452
std                                        1.016140                1.099374
min                                       12.776834               12.772084
25%                                       15.188950               15.528794
50%                                       15.853412               16.196423
75%                                       16.130323               16.455247
max                                       16.600736               17.278809

       concept_diversity_assistant
count                   211.000000
mean                     16.009702
std                       0.760243
min                      14.179806
25%                      15.769523
50%                      16.313468
75%                      16.582519
max                      17.022775
Creating panel temporal_panel2...
Saving panel temporal_panel2...
Panel temporal_panel2 created and saved.
Panel temporal_panel2 shape: (2701267, 8)
Panel temporal_panel2 head:
                      cluster_nsamples_user_concepts_explicit  cluster_nsamples_assistant_concepts_explicit  ...  cluster_mean_conversation_length  cluster_mean_prompt_length
time is_gpt4 cluster                                                                                         ...
118  0       434978                                        66                                            32  ...                       5584.110778                 3856.419162
             511851                                        66                                            32  ...                       5585.476190                 3856.258929
             511849                                        66                                            33  ...                       5584.289398                 3845.487106
             511845                                        66                                            33  ...                       5584.289398                 3845.487106
             511841                                        66                                            34  ...                       5575.054286                 3839.160000

[5 rows x 8 columns]
<class 'pandas.core.frame.DataFrame'>
MultiIndex: 2701267 entries, (np.int64(118), np.int64(0), np.int64(434978)) to (np.int64(99), np.int64(0), np.int64(408895))
Data columns (total 8 columns):
 #   Column                                        Dtype
---  ------                                        -----
 0   cluster_nsamples_user_concepts_explicit       int64
 1   cluster_nsamples_assistant_concepts_explicit  int64
 2   cluster_nsamples_user_concepts_related        int64
 3   cluster_nsamples_assistant_concepts_related   int64
 4   cluster_nsamples                              int64
 5   cluster_mean_turns                            float64
 6   cluster_mean_conversation_length              float64
 7   cluster_mean_prompt_length                    float64
dtypes: float64(3), int64(5)
memory usage: 203.0 MB
Panel temporal_panel2 info:
None
Panel temporal_panel2 summary stats:
       cluster_nsamples_user_concepts_explicit  \
count                             2.701267e+06
mean                              4.635996e+02
std                               7.732765e+02
min                               0.000000e+00
25%                               0.000000e+00
50%                               1.000000e+00
75%                               7.360000e+02
max                               6.849000e+03

       cluster_nsamples_assistant_concepts_explicit  \
count                                  2.701267e+06
mean                                   2.113521e+03
std                                    3.520948e+03
min                                    0.000000e+00
25%                                    1.000000e+00
50%                                    2.000000e+00
75%                                    3.210000e+03
max                                    2.383300e+04

       cluster_nsamples_user_concepts_related  \
count                            2.701267e+06
mean                             1.021599e+03
std                              1.629504e+03
min                              0.000000e+00
25%                              0.000000e+00
50%                              1.000000e+00
75%                              1.677000e+03
max                              9.347000e+03

       cluster_nsamples_assistant_concepts_related  cluster_nsamples  \
count                                 2.701267e+06      2.701267e+06
mean                                  1.239543e+03      3.206629e+03
std                                   1.982991e+03      5.243218e+03
min                                   0.000000e+00      1.000000e+00
25%                                   0.000000e+00      1.000000e+00
50%                                   2.000000e+00      3.000000e+00
75%                                   2.059000e+03      5.089000e+03
max                                   1.228100e+04      3.367800e+04

       cluster_mean_turns  cluster_mean_conversation_length  \
count        2.701267e+06                      2.701267e+06
mean         4.583782e+00                      6.280372e+03
std          4.145665e+00                      6.170563e+03
min          2.000000e+00                      5.000000e+00
25%          2.000000e+00                      3.814000e+03
50%          3.716897e+00                      5.586290e+03
75%          5.770383e+00                      6.932525e+03
max          2.920000e+02                      3.101280e+05

       cluster_mean_prompt_length
count                2.701267e+06
mean                 2.458142e+03
std                  4.549779e+03
min                  0.000000e+00
25%                  4.340000e+02
50%                  2.027661e+03
75%                  3.534773e+03
max                  2.988500e+05
Building user panel...
Warning: unknown GPT version gpt-4-0613
Warning: unknown GPT version gpt-4-0613
Creating panel user_panel...
Saving panel user_panel...
Panel user_panel created and saved.
Panel user_panel shape: (27214, 18)
Panel user_panel head:
                                                   language                   location  ...            concept_diversity_assistant_across_time                      concept_diversity_across_time
user                                                                                    ...
50d2cdeb8c7affcdd0f0b2508ac6508aa7ebb26667df767...  English           (China, Beijing)  ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...
7ead91b188582830b3572357d8a3092577ac2606c05fc1f...  Russian   (Russia, St.-Petersburg)  ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...
462687cbfb5147a27304a97b4d81fd924d7ced52bd5b613...  Chinese              (China, None)  ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...
03ab7e216f40159ec20ee5c5fd9bac196d8e08c3fe28794...  English  (United States, Missouri)  ...  (14.355682379443097, 16.766440905689205, 16.97...  (14.486416709713833, 17.138679253534423, 15.58...
a89177c80571053584234edca85f348690bf0ab5873876a...  English   (United States, Georgia)  ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...  (nan, nan, nan, nan, nan, nan, nan, nan, nan, ...

[5 rows x 18 columns]
<class 'pandas.core.frame.DataFrame'>
Index: 27214 entries, 50d2cdeb8c7affcdd0f0b2508ac6508aa7ebb26667df76715bee1c3b3be9dc2c to 642d6592402ced55ce3b38cc4a6e27680f812394bec5353cafc7e79b62ffd1aa
Data columns (total 18 columns):
 #   Column                                         Non-Null Count  Dtype
---  ------                                         --------------  -----
 0   language                                       27214 non-null  object
 1   location                                       27214 non-null  object
 2   nsamples                                       27214 non-null  int64
 3   nsamples_temporal_composition                  27214 non-null  object
 4   nsamples_version_composition                   27214 non-null  object
 5   temporal_extension                             27214 non-null  float64
 6   version_diversity                              27214 non-null  float64
 7   mean_turns                                     27214 non-null  float64
 8   mean_conversation_length                       27214 non-null  float64
 9   mean_prompt_length                             27214 non-null  float64
 10  concept_diversity                              27195 non-null  float64
 11  concept_diversity_user_concepts_explicit       20204 non-null  float64
 12  concept_diversity_assistant_concepts_explicit  27049 non-null  float64
 13  concept_diversity_user_concepts_related        25351 non-null  float64
 14  concept_diversity_assistant_concepts_related   26081 non-null  float64
 15  concept_diversity_user_across_time             27214 non-null  object
 16  concept_diversity_assistant_across_time        27214 non-null  object
 17  concept_diversity_across_time                  27214 non-null  object
dtypes: float64(10), int64(1), object(7)
memory usage: 3.9+ MB
Panel user_panel info:
None
Panel user_panel summary stats:
           nsamples  temporal_extension  version_diversity    mean_turns  \
count  27214.000000        27214.000000       27214.000000  27214.000000
mean      19.680165            4.196038           0.894515      4.668826
std      108.411422            7.963584           0.185027      3.319945
min        4.000000            0.000000           0.200000      0.800000
25%        5.000000            0.000000           0.825442      2.250000
50%        7.000000            0.500000           1.000000      3.714286
75%       13.000000            4.150301           1.000000      5.818182
max     6526.000000           58.522966           1.000000     59.200000

       mean_conversation_length  mean_prompt_length  concept_diversity  \
count              27214.000000        27214.000000       27195.000000
mean                4960.910545         1823.611235          15.578278
std                 5646.330830         4410.384500           1.684814
min                   15.500000            0.000000           1.459432
25%                 2101.375000          180.515625          14.448992
50%                 3963.833333          618.300175          15.804074
75%                 6163.000000         2753.859375          16.802029
max               179299.250000       171766.777778          18.931569

       concept_diversity_user_concepts_explicit  \
count                              20204.000000
mean                                  15.636826
std                                    3.363565
min                                   -8.415037
25%                                   14.275078
50%                                   16.464887
75%                                   18.113127
max                                   18.931569

       concept_diversity_assistant_concepts_explicit  \
count                                   27049.000000
mean                                       15.663256
std                                         1.994667
min                                         0.459432
25%                                        14.532198
50%                                        15.913313
75%                                        17.018267
max                                        18.931569

       concept_diversity_user_concepts_related  \
count                             25351.000000
mean                                 13.754450
std                                   3.616076
min                                  -5.415037
25%                                  11.967136
50%                                  14.596928
75%                                  16.253470
max                                  18.931569

       concept_diversity_assistant_concepts_related
count                                  26081.000000
mean                                      14.399226
std                                        3.116109
min                                       -6.000000
25%                                       12.953219
50%                                       15.023361
75%                                       16.413154
max                                       18.931569
Saving user_panel to ./data/sample500000-user_panel.csv...
Saving temporal_panel1 to ./data/sample500000-temporal_panel1.csv...
Saving temporal_panel2 to ./data/sample500000-temporal_panel2.csv...
(base) aq_alexqiu@instance-20250107-222116:~/Modeling-Value-Lockin/data-analysis$

